# Tech-Spec: Project Initialization & Core Architecture Setup (Story 1.1)

**Created:** 2025-12-31
**Status:** Implementation Complete

## Overview

### Problem Statement
The current project is a bare-bones Electron application generated by `electron-forge` with a flat directory structure. It lacks the core technologies defined in the architecture (React, SQLite, Zustand, Zod, Tailwind) and the required folder structure (`src/features`, `src/shared`) to support a scalable, offline-first application.

### Solution
We will upgrade the existing shell into a full "Judo Command Center" foundation by:
1.  Installing and configuring the React frontend stack.
2.  Setting up `better-sqlite3` with WAL mode for robust offline data.
3.  Implementing the "Feature-Based" directory structure.
4.  Establishing a type-safe IPC bridge using `Zod` validation.

### Scope (In/Out)
**IN:**
- React, Tailwind, Lucide-React installation.
- SQLite + WAL configuration in Main process.
- IPC Bridge implementation (Typed).
- Directory structure creation.
- Basic "Hello World" verification of the stack.

**OUT:**
- Actual Athlete features (CRUD).
- Complex UI components (Dashboard).

## Context for Development

### Codebase Patterns
- **Architecture**: Separated Main/Renderer with Typed IPC.
- **Structure**: `src/features` for domain logic, `src/shared` for types/constants.
- **State**: Zustand (to be installed) for frontend state.

### Files to Reference
- `docs/architecture.md`: Defines the folder structure and patterns.
- `package.json`: Target for dependency updates.
- `vite.renderer.config.ts` & `vite.main.config.ts`: Vite build settings.

## Implementation Plan

### Tasks

- [x] **Task 1: Dependency Installation**
    - Install Prod: `react`, `react-dom`, `better-sqlite3`, `clsx`, `tailwind-merge`, `zustand`, `lucide-react`.
    - Install Dev: `typescript` (verify version), `@types/react`, `@types/react-dom`, `autoprefixer`, `postcss`, `tailwindcss`, `@vitejs/plugin-react`.

- [x] **Task 2: Configuration Updates**
    - Update `tsconfig.json` to support JSX (`"jsx": "react-jsx"`).
    - Update `vite.renderer.config.ts` to use `@vitejs/plugin-react`.
    - Initialize Tailwind (`npx tailwindcss init -p`) and configure `tailwind.config.js`.

- [x] **Task 3: Directory Structure Setup**
    - Create `src/features`, `src/shared/types`, `src/shared/constants`, `src/main`, `src/renderer`.
    - Move `main.ts` -> `src/main/main.ts`.
    - Move `renderer.ts` -> `src/renderer/renderer.tsx`.
    - Create `src/db` for SQLite connection logic.

- [x] **Task 4: SQLite & IPC Setup**
    - Implement `src/main/db.ts`: Initialize `better-sqlite3` with `pragma journal_mode = WAL`.
    - Create `src/main/preload.ts`: Expose safe API.
    - Test connection on app launch (log message).

### Acceptance Criteria

- [x] **AC 1: React & Tailwind Rendering**
    - App launches with a React Root component.
    - Tailwind classes (e.g., `bg-slate-900`) apply correctly.

- [x] **AC 2: SQLite Connection**
    - App logs "Database initialized in WAL mode" to console on startup.
    - A `.db` file is created in the user data directory (or valid local path).

- [x] **AC 3: Type-Safe Architecture**
    - No direct node integration in Renderer (`nodeIntegration: false`).
    - `src/features` folder exists.

## Additional Context

### Testing Strategy
- Manual verify via `npm start`.
- Check DevTools console for React mount and Database logs.

## Review Notes

**Adversarial Review Completed:** 2025-12-31

**Findings:** 13 total (1 Blocking, 1 Critical, 4 High, 6 Medium, 3 Low)

**Resolution Summary:**
- **F0 [BLOCKING]**: Tailwind PostCSS plugin error - Fixed by installing `@tailwindcss/postcss`
- **F1 [CRITICAL]**: Database initialization failing - Fixed by configuring Vite to externalize `better-sqlite3`
- **F2 [HIGH]**: Old files not removed - Fixed by deleting `src/main.ts`, `src/preload.ts`, `src/renderer.ts`
- **F3 [HIGH]**: Module system migration - Verified production build works correctly
- **F4 [HIGH]**: Missing type definitions - Created `src/shared/types/electron.d.ts`
- **F5 [MEDIUM]**: Incomplete IPC - Noted for future implementation
- **F6 [MEDIUM]**: No error handling - Already fixed with try-catch in db.ts
- **F7 [MEDIUM]**: Hardcoded database name - Fixed by creating constants file
- **F8 [MEDIUM]**: Missing Zod validation - Acceptable (installed for future use)
- **F9 [MEDIUM]**: Tailwind config - Verified glob pattern is correct
- **F10 [LOW]**: Package.json metadata - Updated app name and description
- **F11 [LOW]**: Missing React StrictMode - Added to renderer
- **F12 [LOW]**: No loading state - Added basic loading state to renderer

**All Critical and High findings resolved. Medium and Low findings either fixed or documented as acceptable.**
